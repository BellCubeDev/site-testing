var X,V;import*as Q from"../../universal.js";import*as Y from"./fomod-builder.js";import"./fomod-builder-bindings.js";import"./fomod-builder-steps-1st-party.js";import"./fomod-builder-steps-vortex.js";import"./fomod-builder-steps-mo2.js";import*as Z from"../../filesystem-interface.js";import*as ee from"./fomod-builder-xml-translator.js";import oe from"../../included_node_modules/plural/index.js";const te=oe;import ne from"../../included_node_modules/vkbeautify/index.js";const re=ne;export function updatePluralDisplay(e,o){e.textContent=o+" "+te(e.getAttribute("unitWord")??"",o)}!function(e){e.Explicit="Manual",e.Ascending="Alphabetical",e.Descending="Reverse Alphabetical",e.SelectAny="Allow Any Selections",e.SelectAll="Force-Select Everything",e.SelectExactlyOne="Require Exactly One Selection",e.SelectAtMostOne="Require One or No Selections",e.SelectAtLeastOne="Require At Least One Selection",e.NotUsable="Not Useable",e.CouldBeUsable="Could Be Useable"}(X||(X={}));!function(e){e.Manual="Explicit",e.Alphabetical="Ascending",e["Reverse Alphabetical"]="Descending",e["Allow Any Selections"]="SelectAny",e["Force-Select Everything"]="SelectAll",e["Require Exactly One Selection"]="SelectExactlyOne",e["Require One or No Selections"]="SelectAtMostOne",e["Require At Least One Selection"]="SelectAtLeastOne",e["Not Useable"]="NotUsable",e["Could Be Useable"]="CouldBeUsable"}(V||(V={}));export function translateDropdown(e){return"string"!=typeof e?e:e in X?X[e]:e in V?V[e]:e}export class BCDDropdownSortingOrder extends Q.BCDDropdown{static asString="FOMOD Builder - Sorting Order Dropdown";static cssClass="bcd-dropdown-sorting-order";constructor(e){super(e,e.previousElementSibling,!0)}options(){return{Manual:null,Alphabetical:null,"Reverse Alphabetical":null}}}export class BCDDropdownGroupType extends Q.BCDDropdown{static asString="FOMOD Builder - Group Type Dropdown";static cssClass="bcd-dropdown-group-type";constructor(e){super(e,e.previousElementSibling,!0)}options(){return{"Allow Any Selections":null,"Force-Select Everything":null,"Require Exactly One Selection":null,"Require One or No Selections":null,"Require At Least One Selection":null}}}export class BCDDropdownOptionState extends Q.BCDDropdown{static asString="FOMOD Builder - Option State Dropdown";static cssClass="bcd-dropdown-option-state";constructor(e){super(e,e.previousElementSibling,!0)}options(){return{Optional:null,Recommended:null,"Could Be Useable":null,Required:null,"Not Useable":null}}}let ie=!0;export function setStepEditorType(e){["builder"].includes(e)||(e="builder");const o=document.getElementById(`steps-${e}-container`),t=o.parentElement.querySelectorAll(`.fomod-editor-type:not(#steps-${e}-container)${ie?"":".active"}`);function n(){t.forEach(e=>{e.classList.remove("active_"),e.removeEventListener("transitionend",n),e.ariaHidden="true",e.setAttribute("hidden","")}),o.classList.add("active_"),o.ariaHidden="false",o.removeAttribute("hidden"),Q.nestAnimationFrames(2,()=>{o.classList.add("active")})}!ie&&o.classList.contains(".active")||("builder"!==e&&(window.lazyStylesLoaded?o.classList.remove("needs-lazy"):o.classList.add("needs-lazy")),0===t.length?n():(t.forEach(e=>{e.classList.remove("active"),e.addEventListener("transitionend",n,{once:!0})}),setTimeout(n,200)),ie=!1,window.FOMODBuilder.storage.preferences.stepsBuilder=e)}export async function showOpenAnotherFolderDialog(){const e=document.getElementById("opening-other-project-modal").upgrades.getExtends(Q.BCDModalDialog)[0],o=await e.show();return"confirm"!==o?(console.debug(`User cancelled opening another folder with response "${o}"`),!1):(console.debug(`User confirmed opening another folder with response "${o}"`),!0)}let le=null;export async function openFolder(e=!1){if(!loadingFomod.state&&(!window.FOMODBuilder.directory&&!window.FOMODBuilder.trackedFomod||await showOpenAnotherFolderDialog())){if(e)return loadingFomod.state=!0,window.loadTestFOMOD(),void postLoad();if("showDirectoryPicker"in window)return await openFolder_entry();postLoad(!1),console.warn("No directory picker available for your system!"),Y.getNoSupportModal()?.show()}}export async function postLoad(e=!0){await Q.wait(100),loadingFomod.state=!1,le??=document.getElementById("tablist"),e?(le.removeAttribute("disabled"),le.classList.remove("tabs-list-container--hidden")):(le.setAttribute("disabled",""),le.classList.add("tabs-list-container--hidden"))}export const loadingFomod={state:!1};export async function openFolder_entry(){if(loadingFomod.state)return;loadingFomod.state=!0,console.debug("Opening a folder!");const e=await Z.getUserPickedFolder(!0);if(!e)return loadingFomod.state=!1;console.debug("Picked folder:",e),console.debug("Picked folder name:",e?.handle.name),console.debug("Picked folder perms?",await(e?.handle.queryPermission({mode:"readwrite"}))),window.FOMODBuilder.directory=e;const o=await e.childDirsC.fomod,t=o.childFilesC["ModuleConfig.xml"].then(e=>e.readAsText()),n=o.childFilesC["Info.xml"].then(e=>e.readAsText()),[r,i]=await Promise.all([t,n]);ee.translateWhole(r,i,!0),postLoad()}export async function setOutputElements(){if(se)return;if(se=!0,!window.FOMODBuilder.trackedFomod)throw new Error("No FOMOD is currently loaded.");const e=window.FOMODBuilder.trackedFomod.infoDoc,o=window.FOMODBuilder.trackedFomod.moduleDoc;let t=window.FOMODBuilder.trackedFomod.obj.asInfoXML(e).outerHTML||"\x3c!-- ERROR - Serialized document was empty! --\x3e";t=window.FOMODBuilder.storage.settings.formatXML?re.xml(t):re.xmlmin(t,!0),console.log({infoString:t}),document.getElementById("info-xml").textContent=t;let n=window.FOMODBuilder.trackedFomod.obj.asModuleXML(o).outerHTML||"\x3c!-- ERROR - Serialized document was empty! --\x3e";n=window.FOMODBuilder.storage.settings.formatXML?re.xml(n):re.xmlmin(n,!0),console.log({moduleString:n}),document.getElementById("module-xml").textContent=n,se=!1}function de(e){return window.FOMODBuilder.storage.settings.formatXML?re.xml(e):re.xmlmin(e,!0)}let se=!1;export async function save(){if(se)return;if(se=!0,!window.FOMODBuilder.trackedFomod)throw new Error("No FOMOD is currently loaded.");if(!window.FOMODBuilder.directory)return await setOutputElements(),se=!1;const e=await window.FOMODBuilder.directory.childDirsC.fomod,o=e.childFilesC["Info.xml"],t=e.childFilesC["ModuleConfig.xml"],[n,r]=await Promise.all([o,t]),i=window.FOMODBuilder.trackedFomod.infoDoc,l=de(window.FOMODBuilder.trackedFomod.obj.asInfoXML(i).outerHTML||"\x3c!-- ERROR - Serialized document was empty! --\x3e"),d=n.write(l);console.log({infoString:l});const s=window.FOMODBuilder.trackedFomod.moduleDoc,a=de(window.FOMODBuilder.trackedFomod.obj.asModuleXML(s).outerHTML||"\x3c!-- ERROR - Serialized document was empty! --\x3e"),c=r.write(a);console.log({moduleString:a}),await Promise.all([d,c]),ce=!1,se=!1}export async function cleanSave(){if(!se){if(!window.FOMODBuilder.trackedFomod)throw new Error("No FOMOD is currently loaded.");return window.FOMODBuilder.trackedFomod.infoDoc=window.domParser.parseFromString("<fomod/>","text/xml"),window.FOMODBuilder.trackedFomod.moduleDoc=window.domParser.parseFromString("<config/>","text/xml"),await save()}}let ae=null,ce=!1;export function autoSave(){se||loadingFomod.state||window.FOMODBuilder.trackedFomod&&(ce=!0,window.FOMODBuilder.storage.settings.autoSaveAfterChange&&(null!==ae&&clearTimeout(ae),ae=Q.afterDelay(500,()=>{ae=null,window.FOMODBuilder.storage.settings.autoCleanSave?cleanSave():save()})))}window.addEventListener("beforeunload",e=>{if(ce)return e.preventDefault(),e.returnValue="",""});export function init(){Q.registerBCDComponents(BCDDropdownSortingOrder,BCDDropdownOptionState,BCDDropdownGroupType),setStepEditorType(window.FOMODBuilder.storage.preferences.stepsBuilder),window.fomodUndoManager=fomodUndoManager,window.registerForEvents(document,{save:()=>save()}),console.log("FOMOD Builder UI initialized.")}
//# sourceMappingURL=https://raw.githubusercontent.com/BellCubeDev/site-testing/deployment/tools/fomod/fomod-builder-ui.js.map